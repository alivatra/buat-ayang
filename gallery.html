<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Galeri Kenangan üíñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root {
      --gradient1: #ffdde1;
      --gradient2: #ee9ca7;
      --accent: #ff4d88;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, var(--gradient1), var(--gradient2));
      font-family: 'Poppins', sans-serif;
    }

    .card {
      background: rgba(255,255,255,0.95);
      border-radius: 25px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
      border: none;
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .gallery img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      transition: transform 0.3s ease;
    }

    .gallery img:hover {
      transform: scale(1.05);
    }

    .upload-box {
      border: 2px dashed #ff7ac2;
      border-radius: 20px;
      padding: 25px;
      cursor: pointer;
      color: #ff4d88;
      font-weight: 500;
    }
  </style>
</head>

<body class="p-4">

<div class="container">
  <a href="index.html" class="btn btn-outline-light mb-3">‚Üê Kembali</a>

  <div class="card p-4 text-center">
    <h3 class="fw-bold mb-2">üì∏ Galeri Kenangan Kita</h3>
    <p class="text-muted">Setiap foto adalah cerita kita üíï</p>

    <label class="upload-box w-100 mb-4">
      ‚ûï Upload Foto Kenangan
      <input type="file" id="photoInput" accept="image/*" hidden>
    </label>

    <div class="gallery" id="gallery"></div>

    <p class="text-muted mt-4" style="font-size:0.85rem">
      Foto yang diupload akan tersimpan selamanya ü§ç
    </p>
  </div>
</div>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import {
    getFirestore, collection, addDoc, getDocs, query, orderBy
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";
  import {
    getStorage, ref, uploadBytes, getDownloadURL
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBNs26AX1PuSK-JfhtekLM-aIBE0KHV70w",
    authDomain: "foto-kenangan-476c1.firebaseapp.com",
    projectId: "foto-kenangan-476c1",
    storageBucket: "foto-kenangan-476c1.firebasestorage.app",
    messagingSenderId: "637045965870",
    appId: "1:637045965870:web:9674a2b0656940c5a7cbbf"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const gallery = document.getElementById("gallery");
  const photoInput = document.getElementById("photoInput");

  async function loadGallery() {
    gallery.innerHTML = "";
    const q = query(collection(db, "gallery"), orderBy("createdAt", "desc"));
    const snap = await getDocs(q);

    snap.forEach(doc => {
      const data = doc.data();
      const img = document.createElement("img");
      img.src = data.url;
      gallery.appendChild(img);
    });
  }

  photoInput.addEventListener("change", async () => {
    const file = photoInput.files[0];
    if (!file) return;

    const path = `gallery/${Date.now()}-${file.name}`;
    const storageRef = ref(storage, path);

    await uploadBytes(storageRef, file);
    const url = await getDownloadURL(storageRef);

    await addDoc(collection(db, "gallery"), {
      url,
      createdAt: Date.now()
    });

    photoInput.value = "";
    loadGallery();
  });

  loadGallery();
</script>

</body>
</html>
